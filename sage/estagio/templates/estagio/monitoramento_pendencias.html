{% extends 'base.html' %}

{% block title %}Monitoramento de Pendências - Sistema de Gestão de Estágios{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h2><i class="fas fa-bell"></i> Monitoramento de Pendências</h2>
        <p class="subtitle">Acompanhamento de pendências e resultados consolidados</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Cards de Resumo -->
    <div class="estatisticas-grid">
        <div class="stat-card stat-total">
            <div class="stat-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ total_pendencias }}</span>
                <span class="stat-label">Total de Pendências</span>
            </div>
        </div>
        
        <div class="stat-card stat-criticas">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ total_criticas }}</span>
                <span class="stat-label">Pendências Críticas</span>
            </div>
        </div>
        
        <div class="stat-card stat-estagios">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ resultados_consolidados.estagios.total }}</span>
                <span class="stat-label">Total Estágios</span>
            </div>
        </div>
        
        <div class="stat-card stat-documentos">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ resultados_consolidados.documentos.total }}</span>
                <span class="stat-label">Total Documentos</span>
            </div>
        </div>
    </div>

    <!-- Pendências Críticas -->
    {% if pendencias_criticas %}
    <div class="card mt-4 border-danger">
        <div class="card-header bg-danger text-white">
            <h3><i class="fas fa-exclamation-circle"></i> Pendências Críticas - Atenção Imediata</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Data Limite</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pendencia in pendencias_criticas %}
                        <tr class="table-danger">
                            <td><span class="badge badge-danger">{{ pendencia.tipo }}</span></td>
                            <td>{{ pendencia.descricao }}</td>
                            <td>{{ pendencia.data_limite|date:"d/m/Y" }}</td>
                            <td>
                                {% if pendencia.url %}
                                <a href="{{ pendencia.url }}" class="btn btn-sm btn-danger">
                                    <i class="fas fa-arrow-right"></i> Resolver
                                </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Filtros -->
    <div class="card filtros-card mt-4">
        <div class="card-body">
            <form method="get" class="filtros-form">
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="tipo">Tipo de Pendência</label>
                        <select name="tipo" id="tipo" class="form-control">
                            <option value="">Todos os tipos</option>
                            {% for key, value in tipos_pendencia.items %}
                            <option value="{{ key }}" {% if filtro_tipo == key %}selected{% endif %}>{{ value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="critico">Criticidade</label>
                        <select name="critico" id="critico" class="form-control">
                            <option value="">Todas</option>
                            <option value="true" {% if filtro_critico == 'true' %}selected{% endif %}>Apenas Críticas</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4 align-self-end">
                        <button type="submit" class="btn btn-secondary btn-block">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Lista de Pendências -->
    <div class="card mt-4">
        <div class="card-header">
            <h3><i class="fas fa-list"></i> Todas as Pendências</h3>
        </div>
        <div class="card-body">
            {% if pendencias %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Data Limite</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pendencia in pendencias %}
                        <tr class="{% if pendencia.critico %}table-warning{% endif %}">
                            <td><span class="badge badge-info">{{ pendencia.tipo }}</span></td>
                            <td>{{ pendencia.descricao }}</td>
                            <td>{{ pendencia.data_limite|date:"d/m/Y" }}</td>
                            <td>
                                {% if pendencia.critico %}
                                <span class="badge badge-danger">Crítica</span>
                                {% else %}
                                <span class="badge badge-secondary">Normal</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if pendencia.url %}
                                <a href="{{ pendencia.url }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state text-center py-5">
                <i class="fas fa-check-circle fa-3x text-success"></i>
                <h3 class="mt-3">Nenhuma pendência encontrada</h3>
                <p class="text-muted">Parabéns! Não há pendências registradas.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Resultados Consolidados -->
    <div class="card mt-4">
        <div class="card-header">
            <h3><i class="fas fa-chart-pie"></i> Resultados Consolidados</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h5>Estágios</h5>
                    <p><strong>Total:</strong> {{ resultados_consolidados.estagios.total }}</p>
                    <p><strong>Em Análise:</strong> {{ resultados_consolidados.estagios.analise }}</p>
                    <p><strong>Aprovados:</strong> {{ resultados_consolidados.estagios.aprovado }}</p>
                </div>
                <div class="col-md-4">
                    <h5>Documentos</h5>
                    <p><strong>Total:</strong> {{ resultados_consolidados.documentos.total }}</p>
                    <p><strong>Pendentes:</strong> {{ resultados_consolidados.documentos.pendentes }}</p>
                    <p><strong>Aprovados:</strong> {{ resultados_consolidados.documentos.aprovados }}</p>
                </div>
                <div class="col-md-4">
                    <h5>Horas</h5>
                    <p><strong>Total Cumpridas:</strong> {{ resultados_consolidados.horas.total_horas }}h</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.estatisticas-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.stat-icon {
    font-size: 2em;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
}

.stat-total .stat-icon { background: #e3f2fd; color: #1976d2; }
.stat-criticas .stat-icon { background: #fce4ec; color: #c2185b; }
.stat-estagios .stat-icon { background: #e8f5e9; color: #388e3c; }
.stat-documentos .stat-icon { background: #fff3e0; color: #f57c00; }

.stat-value {
    display: block;
    font-size: 1.8em;
    font-weight: bold;
    color: #333;
}

.stat-label {
    color: #666;
}

@media (max-width: 768px) {
    .estatisticas-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}
