{% extends 'base.html' %}

{% block title %}Painel de Estágios - Sistema de Gestão de Estágios{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h2><i class="fas fa-tachometer-alt"></i> Painel de Estágios</h2>
        <p class="subtitle">{{ perfil_usuario|title }} - Visão geral dos estágios</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Cards de Resumo -->
    <div class="estatisticas-grid">
        <div class="stat-card stat-total">
            <div class="stat-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ estatisticas.total }}</span>
                <span class="stat-label">Total de Estágios</span>
            </div>
        </div>
        
        <div class="stat-card stat-analise">
            <div class="stat-icon">
                <i class="fas fa-search"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ estatisticas.analise }}</span>
                <span class="stat-label">Em Análise</span>
            </div>
        </div>
        
        <div class="stat-card stat-aprovados">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ estatisticas.aprovado }}</span>
                <span class="stat-label">Aprovados</span>
            </div>
        </div>
        
        <div class="stat-card stat-reprovados">
            <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ estatisticas.reprovado }}</span>
                <span class="stat-label">Reprovados</span>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card filtros-card mt-4">
        <div class="card-body">
            <form method="get" class="filtros-form">
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="status">Status</label>
                        <select name="status" id="status" class="form-control">
                            <option value="">Todos os status</option>
                            {% for value, display in status_choices %}
                            <option value="{{ value }}" {% if filtro_status == value %}selected{% endif %}>{{ display }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="empresa">Empresa</label>
                        <input type="text" name="empresa" id="empresa" class="form-control" placeholder="Filtrar por empresa" value="{{ filtro_empresa }}">
                    </div>
                    <div class="form-group col-md-4 align-self-end">
                        <button type="submit" class="btn btn-secondary btn-block">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Estágios por Status -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Lista de Estágios</h3>
                </div>
                <div class="card-body">
                    {% if estagios %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Cargo</th>
                                    <th>Empresa</th>
                                    <th>Período</th>
                                    <th>Carga Horária</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for estagio in estagios %}
                                <tr class="estagio-row status-{{ estagio.status }}">
                                    <td>
                                        <strong>{{ estagio.titulo }}</strong>
                                        {% if estagio.aluno_solicitante %}
                                        <br>
                                        <small class="text-muted">Aluno: {{ estagio.aluno_solicitante.nome }}</small>
                                        {% endif %}
                                    </td>
                                    <td>{{ estagio.cargo }}</td>
                                    <td>{{ estagio.empresa.razao_social }}</td>
                                    <td>
                                        {{ estagio.data_inicio|date:"d/m/Y" }}
                                        <br>
                                        <small>até {{ estagio.data_fim|date:"d/m/Y" }}</small>
                                    </td>
                                    <td>{{ estagio.carga_horaria }}h/semana</td>
                                    <td>
                                        {% if estagio.status == 'analise' %}
                                        <span class="badge badge-warning">Em Análise</span>
                                        {% elif estagio.status == 'em_andamento' %}
                                        <span class="badge badge-info">Em Andamento</span>
                                        {% elif estagio.status == 'aprovado' %}
                                        <span class="badge badge-success">Aprovado</span>
                                        {% elif estagio.status == 'reprovado' %}
                                        <span class="badge badge-danger">Reprovado</span>
                                        {% else %}
                                        <span class="badge badge-secondary">{{ estagio.get_status_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="actions">
                                        <a href="{% url 'estagio_detalhe' estagio.id %}" class="btn btn-sm btn-info" title="Ver Detalhes">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state text-center py-5">
                        <i class="fas fa-clipboard-list fa-3x text-muted"></i>
                        <h3 class="mt-3">Nenhum estágio encontrado</h3>
                        <p class="text-muted">Não existem estágios cadastrados com os filtros selecionados.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.estatisticas-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.stat-icon {
    font-size: 2em;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
}

.stat-total .stat-icon { background: #e3f2fd; color: #1976d2; }
.stat-analise .stat-icon { background: #fff3e0; color: #f57c00; }
.stat-aprovados .stat-icon { background: #e8f5e9; color: #388e3c; }
.stat-reprovados .stat-icon { background: #fce4ec; color: #c2185b; }

.stat-value {
    display: block;
    font-size: 1.8em;
    font-weight: bold;
    color: #333;
}

.stat-label {
    color: #666;
}

.estagio-row.status-analise { border-left: 3px solid #ffc107; }
.estagio-row.status-em_andamento { border-left: 3px solid #17a2b8; }
.estagio-row.status-aprovado { border-left: 3px solid #28a745; }
.estagio-row.status-reprovado { border-left: 3px solid #dc3545; }

@media (max-width: 768px) {
    .estatisticas-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}
